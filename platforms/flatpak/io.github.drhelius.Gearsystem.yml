id: io.github.drhelius.Gearsystem
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: gearsystem
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --device=all # Allows for controller input
modules:
  - name: glu
    buildsystem: meson
    sources:
      - type: archive
        url: https://archive.mesa3d.org/glu/glu-9.0.3.tar.xz
        sha256: bd43fe12f374b1192eb15fe20e45ff456b9bc26ab57f0eee919f96ca0f8a330f
  - name: glew
    no-autogen: true
    make-args:
      - GLEW_PREFIX=${FLATPAK_DEST}
      - GLEW_DEST=${FLATPAK_DEST}
      - LIBDIR=${FLATPAK_DEST}/lib
      - CFLAGS.EXTRA:=${CFLAGS} -fPIC
      - LDFLAGS.EXTRA=${LDFLAGS}
    make-install-args:
      - GLEW_PREFIX=${FLATPAK_DEST}
      - GLEW_DEST=${FLATPAK_DEST}
      - LIBDIR=${FLATPAK_DEST}/lib
      - CFLAGS.EXTRA:=${CFLAGS} -fPIC
      - LDFLAGS.EXTRA=${LDFLAGS}
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/glew/glew/2.2.0/glew-2.2.0.tgz
        sha256: d4fc82893cfb00109578d0a1a2337fb8ca335b3ceccf97b97e5cc7f08e4353e1
    cleanup:
      - /include
      - /lib/pkgconfig
      - /lib/*.a
  - name: SDL2
    buildsystem: autotools
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/libsdl-org/SDL/releases/download/release-2.30.0/SDL2-2.30.0.tar.gz
        sha256: 36e2e41557e0fa4a1519315c0f5958a87ccb27e25c51776beb6f1239526447b0
    cleanup:
      - /bin/sdl2-config
      - /include
      - /lib/libSDL2.la
      - /lib/libSDL2main.a
      - /lib/libSDL2main.la
      - /lib/libSDL2_test.a
      - /lib/libSDL2_test.la
      - /lib/cmake
      - /share/aclocal
      - /lib/pkgconfig
  - name: nfde
    buildsystem: cmake
    config-opts:
      - -DNFD_PORTAL=ON
      - -DCMAKE_BUILD_TYPE=Release
      - -DNFD_BUILD_TESTS=OFF
      - -DCMAKE_INSTALL_INCLUDEDIR=include/nfd
    sources:
      - type: git
        url: https://github.com/btzy/nativefiledialog-extended.git
        tag: v1.1.1
        commit: 5786fabceeaee4d892f3c7a16b243796244cdddc
  - name: gearsystem
    buildsystem: simple
    build-commands:
      - make
      - make install prefix="$FLATPAK_DEST"
    subdir: platforms/flatpak
    sources:
      # A reference to a specific commit is used whilst this is in development.
      # Ideally this will use either a release archive or a specific tag/commit
      # pair.
      # There is also an option to use a type of "dir" and a path of "../.." to
      # allow for builds from the current commit. This may be useful for
      # "master" or "nightly" builds, but this may require further exploration.
      - type: dir
        path: ../..
